{% extends "./layouts/base.html" %} 
{% block content %} 
<h2 class="text-center mb-4">Reporte Semanal De Seguridad de las Obras en México</h2>
        
        <!-- Table -->
        <div class="table-container mb-5">
          <table class="data-table">
            <thead>
              <tr>
                <th>No.</th>
                <th>Categoría</th>
                <th>Total Semanal</th>
                <th>NipponExpress (Apaseo)</th>
                <th>Hirotec (San Luis)</th>
                <th>Daikin (San Luis)</th>
                <th>Nissin (Apaseo)</th>
                <th>Mitsui (Apaseo)</th>
                <th>Vuteq (Apaseo)</th>
                <th>MetalOne (Bajío)</th>
                <th>TokaiRika (Monterrey)</th>
                <th>MetalOne (Hidalgo)</th>
                <th>DaikyoNishikawa(Bajío)</th>
              </tr>
            </thead>
            <tbody id="data-table-body">
              <!-- Table rows will be inserted here by JavaScript -->
            </tbody>
          </table>
        </div>

        <!-- Chart -->
        <div class="chart-container mb-5">
          <canvas id="data-chart"></canvas>
        </div>
      </div>
    </main>

    <!-- Pie de Página -->
    <footer class="footer mt-auto">
      <div class="container text-center">
        <p class="mb-0">
          Todos los Derechos Reservados &copy; 2024 Fujita Corporation digitlal
        </p>
      </div>
    </footer>

    <!-- Botón Fijo -->
    <button
      class="btn btn-primary sticky-button rounded-circle"
      aria-label="Acción Fija"
    >
      <i class="bi bi-arrow-up"></i>
    </button>

    <!-- Bootstrap 5.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // CSV data
      const csvData = `No.,Categoría,Total Semanal,NipponExpress (Apaseo),Hirotec (San Luis),Daikin (San Luis),Nissin (Apaseo),Mitsui (Apaseo),Vuteq (Apaseo),MetalOne (Bajío),TokaiRika (Monterrey),MetalOne (Hidalgo),DaikyoNishikawa(Bajío)
1,Críticios,2,0,0,2,0,0,0,0,0,0,0
2,Documentos,0,0,0,0,0,0,0,0,0,0,0
3,Ambiental,2,0,2,0,0,0,0,0,0,0,0
4,EPP,2,0,0,0,0,0,1,0,1,0,0
5,Barricadas,8,0,7,0,0,0,1,0,0,0,0
6,Extintores,4,0,1,2,0,0,1,0,0,0,0
7,5S,6,0,2,1,0,0,3,0,0,0,0
8,Herramientas,0,0,0,0,0,0,0,0,0,0,0
9,Alturas,1,0,0,0,0,0,1,0,0,0,0
10,Andamios,6,0,1,2,0,0,3,0,0,0,0
11,CorteSoldadura,0,0,0,0,0,0,0,0,0,0,0
12,Excavaciones,0,0,0,0,0,0,0,0,0,0,0
13,VehículosMaquinaria,0,0,0,0,0,0,0,0,0,0,0
14,Izajes,1,0,0,0,1,0,0,0,0,0,0
15,Demoliciones,0,0,0,0,0,0,0,0,0,0,0
16,BloqueoEnergías,0,0,0,0,0,0,0,0,0,0,0
17,EquipoEléctrico,7,0,1,3,2,0,1,0,0,0,0
18,EspaciosConfinados,0,0,0,0,0,0,0,0,0,0,0
19,SustanciasQuímicas,1,0,0,0,0,0,1,0,0,0,0
20,Otros,3,0,0,1,0,0,1,0,1,0,0
Promedio Semanal,,97,100,92,90,97,100,92,100,99,100,100`;

      // Parse CSV data
      const parseCSV = (csv) => {
        const lines = csv.split('\n');
        return lines.map(line => line.split(','));
      };

      const data = parseCSV(csvData);

      // Populate table
      const tableBody = document.getElementById('data-table-body');
      data.slice(1).forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell;
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      });

      // Create chart
      const ctx = document.getElementById('data-chart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.slice(1, -1).map(row => row[1]),
          datasets: [{
            label: 'Total Semanal',
            data: data.slice(1, -1).map(row => parseInt(row[2])),
            backgroundColor: '#d32f2f',
            borderColor: '#d32f2f',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Total Semanal'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Categoría'
              }
            }
          },
          plugins: {
            title: {
              display: true,
              text: 'Total Semanal por Categoría'
            },
            legend: {
              display: false
            }
          }
        }
      });
    </script>
{% endblock %}
